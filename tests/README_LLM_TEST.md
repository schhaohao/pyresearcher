# LLM 模型测试指南

本目录包含用于测试 LLM 模型可用性的测试脚本。

## 测试脚本

### 1. 测试所有提供商 (`test_llm.py`)

测试所有配置的 LLM 提供商，并生成测试报告。

```bash
# 从项目根目录运行
python tests/test_llm.py
```

**功能：**
- 自动检测所有已配置 API key 的提供商
- 对每个提供商发送测试消息
- 生成详细的测试报告
- 显示成功/失败/跳过的统计信息

**输出示例：**
```
============================================================
开始测试所有 LLM 提供商
============================================================

============================================================
测试 OPENAI...
============================================================
✅ API key 已配置
正在创建 LLM 实例...
✅ LLM 实例创建成功: OpenAILLM(model=gpt-4)
正在发送测试消息...
✅ 测试成功！
响应: 你好！我是一个AI助手...

============================================================
测试总结
============================================================
总计: 4 个提供商
✅ 成功: 2
❌ 失败: 0
⏭️  跳过: 2
```

### 2. 测试单个提供商 (`test_single_llm.py`)

快速测试指定的 LLM 提供商。

```bash
# 测试 OpenAI
python tests/test_single_llm.py --provider openai

# 测试 Anthropic
python tests/test_single_llm.py --provider anthropic

# 测试 DeepSeek
python tests/test_single_llm.py --provider deepseek

# 测试 SiliconFlow
python tests/test_single_llm.py --provider siliconflow

# 指定模型
python tests/test_single_llm.py --provider openai --model gpt-3.5-turbo

# 自定义测试提示词
python tests/test_single_llm.py --provider openai --prompt "请用中文解释什么是机器学习"
```

**参数说明：**
- `--provider`: 必需，提供商名称 (openai, anthropic, deepseek, siliconflow)
- `--model`: 可选，指定模型名称
- `--prompt`: 可选，自定义测试提示词

## 配置要求

在运行测试之前，请确保：

1. **已安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

2. **已配置环境变量**
   
   创建 `.env` 文件（从 `.env.example` 复制）：
   ```bash
   cp .env.example .env
   ```
   
   在 `.env` 文件中填入至少一个 API key：
   ```env
   OPENAI_API_KEY=your_openai_api_key
   # 或其他提供商的 API key
   ```

## 常见问题

### 1. API key 未配置错误

**错误信息：**
```
❌ API key 未配置，跳过测试
```

**解决方法：**
- 检查 `.env` 文件是否存在
- 确认 API key 环境变量名称正确（如 `OPENAI_API_KEY`）
- 确认 API key 值不为空

### 2. 网络连接错误

**错误信息：**
```
❌ 测试失败: Connection error...
```

**解决方法：**
- 检查网络连接
- 确认 API 服务可访问（某些服务可能需要代理）
- 检查防火墙设置

### 3. API key 无效错误

**错误信息：**
```
❌ 测试失败: Invalid API key
```

**解决方法：**
- 确认 API key 正确
- 检查 API key 是否过期
- 确认 API key 有足够的权限/余额

### 4. 模型不存在错误

**错误信息：**
```
❌ 测试失败: Model not found
```

**解决方法：**
- 检查模型名称是否正确
- 确认该模型在指定提供商中可用
- 使用默认模型（不指定 `--model` 参数）

## 测试建议

1. **首次测试**：先运行 `test_llm.py` 查看所有提供商的整体状态
2. **单个测试**：使用 `test_single_llm.py` 深入测试特定提供商
3. **自定义测试**：使用 `--prompt` 参数测试特定场景
4. **模型对比**：使用不同的 `--model` 参数测试不同模型

## 示例输出

### 成功示例

```
============================================================
测试 OPENAI LLM
============================================================

正在创建 LLM 实例...
✅ LLM 创建成功
   提供商: openai
   模型: gpt-4
   温度: 0.7
   最大 tokens: 4000

正在发送测试消息...
提示词: 请用一句话介绍你自己。

============================================================
✅ 测试成功！
============================================================

响应:
你好！我是一个AI助手，由OpenAI开发，可以帮助你回答问题、提供信息和协助完成各种任务。
```

### 失败示例

```
============================================================
测试 OPENAI LLM
============================================================

正在创建 LLM 实例...
❌ 配置错误: 未找到 openai 的 API key。请在 .env 文件中设置相应的环境变量。

提示: 请确保在 .env 文件中配置了 OPENAI_API_KEY
```

